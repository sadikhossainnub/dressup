<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    @media print {
        @page { size: A4 portrait; margin: 5mm; }
        .sketch-container { width: 100% !important; }
    }
    
    * {
        box-sizing: border-box;
        -webkit-print-color-adjust: exact;
    }
    :root {
        --primary: #000;
        --border-color: #000;
        --text-color: #000;
        --label-color: #000;
    }

    .sketch-container {
        font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-size: 8pt;
        color: var(--text-color);
        line-height: 1.05;
        width: 100%;
        background: #fff;
        margin: 0 auto;
    }



    /* Title Bar */
    .title-bar {
        display: block;
        width: 100%;
        margin-bottom: 3px;
        padding-bottom: 1px;
        clear: both;
    }
    .doc-title {
        float: left;
        font-size: 11pt;
        font-weight: 700;
        text-transform: uppercase;
    }
    .doc-meta {
        float: right;
        text-align: right;
        font-weight: 600;
        font-size: 8pt;
    }

    /* Top Info Box */
    .info-box {
        border: 1px solid var(--border-color);
        display: block;
        width: 100%;
        margin-bottom: 5px;
        clear: both;
        overflow: hidden;
    }
    .info-col {
        float: left;
        width: 50%;
        padding: 2px 6px;
        box-sizing: border-box;
    }
    .info-col:first-child {
        border-right: 1px solid var(--border-color);
    }
    .info-row {
        margin-bottom: 0px;
    }
    .label {
        font-weight: 700;
    }

    /* Main Grid Layout */
    .main-grid {
        display: block;
        width: 100%;
        clear: both;
        overflow: hidden;
    }
    .left-panel {
        float: left;
        width: 38%;
        margin-right: 2%;
    }
    .right-panel {
        float: left;
        width: 60%;
    }

    /* Sections */
    .section-box {
        border: 1px solid var(--border-color);
        padding: 4px;
        font-size: 7.5pt;
        margin-bottom: 5px;
        width: 100%;
        box-sizing: border-box;
    }
    .section-header {
        font-weight: 700;
        margin-bottom: 2px;
        text-decoration: underline;
    }
    
    /* Tables in sections */
    .spec-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 6.5pt;
    }
    .spec-table td {
        padding: 0px 0;
        vertical-align: top;
        border-bottom: 0.5px solid var(--border-color);
        line-height: 0.95;
    }
    .spec-table .val {
        text-align: right;
        font-weight: 600;
        font-size: 7pt;
    }

    .cost-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 2px;
    }
    .cost-table td {
        padding: 0px 0;
    }
    .cost-table .cost-val {
        text-align: right;
    }

    /* Image */
    .design-image-container {
        width: 100%;
        min-height: 300px;
        border: 1px solid transparent; 
        display: block;
        background: #fdfdfd;
        text-align: center;
    }
    .design-image {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto;
    }
    
    /* Footer */
    .footer-box {
        border: 1px solid var(--border-color);
        padding: 2px 6px;
        margin-top: 3px;
        min-height: 20px;
        font-size: 7.5pt;
    }

</style>

<div class="sketch-container">

    <!-- Header -->
    <div style="width: 100%; margin-bottom: 5px;">
        {{ letter_head }}
    </div>

    <!-- Title Bar -->
    <div class="title-bar">
        <div class="doc-title">SKETCH SPECIFICATION SHEET</div>
        <div class="doc-meta">
            <div>DOC ID: {{ doc.name }}</div>
            <div>Date: {{ frappe.utils.formatdate(doc.creation) }}</div>
        </div>
    </div>

    <!-- Info Box -->
    <div class="info-box">
        <div class="info-col">
            {% if doc.name %}<div class="info-row"><span class="label">Tech Pack No:</span> {{ doc.name }}</div>{% endif %}
            {% if doc.designer_name %}<div class="info-row"><span class="label">Designer Name:</span> {{ doc.designer_name }}</div>{% endif %}
            {% if doc.design_no %}<div class="info-row"><span class="label">Style No:</span> {{ doc.design_no }}</div>{% endif %}
            {% if doc.category %}<div class="info-row"><span class="label">Category:</span> {{ doc.category }}</div>{% endif %}
            {% if doc.seson %}<div class="info-row"><span class="label">Season:</span> {{ doc.seson }}</div>{% endif %}
            {% if doc.sewing_finish %}<div class="info-row"><span class="label">Sewing Finish:</span> {{ doc.sewing_finish }}</div>{% endif %}
        </div>
        <div class="info-col">
            {% if doc.start_date %}<div class="info-row"><span class="label">Start Date:</span> {{ frappe.utils.formatdate(doc.start_date) if doc.start_date else '' }}</div>{% endif %}
            {% if doc.item_name %}<div class="info-row"><span class="label">Item Name:</span> {{ doc.item_name }}</div>{% endif %}
            {% if doc.cut_fit_style %}<div class="info-row"><span class="label">Cut/ Fit Style:</span> {{ doc.cut_fit_style }}</div>{% endif %}
            {% if doc.collar_neck_style %}<div class="info-row"><span class="label">Collar/ Neck Style:</span> {{ doc.collar_neck_style }}</div>{% endif %}
            {% if doc.side_cut %}<div class="info-row"><span class="label">Side Cut:</span> {{ doc.side_cut }}</div>{% endif %}
            {% if doc.submission_date %}<div class="info-row"><span class="label">Submission Date:</span> {{ frappe.utils.formatdate(doc.submission_date) if doc.submission_date else '' }}</div>{% endif %}
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-grid">
        
        <!-- Left Column -->
        <div class="left-panel">
            
            <!-- Body Measurements -->
            <!-- Body Measurements Logic -->
            {% set measurement_items = [] %}
            {% set m_defs = [
                ('full_length', 'দৈর্ঘ্য (HPS → CF হেম)'),
                ('cf_length', 'CB দৈর্ঘ্য (HPS → CB হেম)'),
                ('cb_length', 'বক্ষ (Chest)'),
                ('waist_circumstance', 'কোমর (Waist)'),
                ('bust', 'উচ্চ হিপ (High Hip)'),
                ('upper_hip', 'নিম্ন হিপ (Low Hip)'),
                ('lower_hip', 'হেম সুইপ (Hem Sweep)'),
                ('front_neck_depth', 'সামনের গলার ড্রপ (Front Neck Drop)'),
                ('back_neck_depth', 'পিছনের গলার ড্রপ (Back Neck Drop)'),
                ('shoulder_tip_to_side_waist', 'গলার প্রস্থ (Neck Width)'),
                ('front_neck_depth_s', 'কলারের প্রস্থ (Collar Width)'),
                ('back_neck_depth_s', 'কলারের উচ্চতা (Collar Height)'),
                ('collar_width_height', 'কাঁধ থেকে কাঁধের প্রস্থ (Shoulder to Shoulder)'),
                ('button_placket_length', 'কাঁধের ঢাল/ড্রপ (Shoulder Drop)'),
                ('button_placket_width', 'আর্মহোলের গভীরতা (Armhole Depth)'),
                ('hem', 'বাটন প্ল্যাকেটের দৈর্ঘ্য (Button Placket Length)'),
                ('shoulder_drop', 'বাটন প্ল্যাকেটের প্রস্থ (Button Placket Width)'),
                ('shoulder', 'স্লিভের দৈর্ঘ্য (Sleeve Length)'),
                ('armhole', 'বাইসেপ (Bicep)'),
                ('full_length_arm', 'এলবো (Elbow)'),
                ('armhole_arm', 'কাফ ওপেনিং (Cuff Opening)'),
                ('biceps', 'বাইসেপ (×2)'),
                ('elbow', 'পকেটের দৈর্ঘ্য (Pocket Length)'),
                ('cuff_length', 'পকেট ওপেনিং (Pocket Opening)'),
                ('cuff_width', 'পকেটের অবস্থান (Pocket Position)'),
                ('cuff_opening', 'আউটসিম (Outseam)'),
                ('pocket_length', 'ইনসিম (Inseam)'),
                ('pocket_width', 'পকেটের প্রস্থ (Pocket Width)'),
                ('pocket_opening', 'ব্যাক রাইজ (Back Rise)'),
                ('pocket_placket', 'কাফের দৈর্ঘ্য (Cuff Length)'),
                ('shoulder_tip_to_pocket_starting', 'কোমর (Relaxed ×2)')
            ] %}
            {% for f, l in m_defs %}
                {% if doc.get(f) %}
                    {% set _ = measurement_items.append((l, doc.get(f))) %}
                {% endif %}
            {% endfor %}
            
            {% if measurement_items %}
            <div class="section-box" style="border:none; padding:0;">
                 <div class="section-header">Body Measurements:</div>
                 <table class="spec-table">
                    {% for label, val in measurement_items %}
                    <tr>
                        <td>{{ label }}</td>
                        <td class="val">{{ val }}</td>
                    </tr>
                    {% endfor %}
                 </table>
            </div>
            {% endif %}

            <!-- Bottom Specs Logic -->
            {% set bottom_items = [] %}
            {% set b_defs = [
                ('length_bottom', 'দৈর্ঘ্য (Length)'),
                ('pocket_wid', 'ফ্রন্ট রাইজ (Front Rise)'),
                ('komor', 'কোমর (Stretched ×2)'),
                ('high_hip', 'উচ্চ হিপ (×2)'),
                ('low_hip', 'নিম্ন হিপ (×2)'),
                ('thigh_uru', 'উরু (Thigh ×2)'),
                ('knee_x2', 'হাঁটু (Knee ×2)'),
                ('leg_opening_x2', 'লেগ ওপেনিং (×2)'),
                ('elasticrubber_width', 'ইলাস্টিক/রাবারের প্রস্থ'),
                ('beltloop_width', 'বেল্ট/লুপের প্রস্থ'),
                ('wb_to_pocket_opening', 'ওয়েস্টব্যান্ড থেকে পকেট ওপেনিং পর্যন্ত দূরত্ব'),
                ('pocket_depth', 'পকেটের গভীরতা')
            ] %}
            {% for f, l in b_defs %}
                {% if doc.get(f) %}
                    {% set _ = bottom_items.append((l, doc.get(f))) %}
                {% endif %}
            {% endfor %}

            {% if bottom_items %}
            <div class="section-box" style="border:none; padding:0; margin-top:5px;">
                 <div class="section-header">Bottom Specifications / নিচের মাপসমূহ</div>
                 <table class="spec-table">
                    {% for label, val in bottom_items %}
                    <tr>
                        <td>{{ label }}</td>
                        <td class="val">{{ val }}</td>
                    </tr>
                    {% endfor %}
                 </table>
            </div>
            {% endif %}

            <!-- Workstations Summary -->
            {% set ws_list = [] %}
            {% if doc.cutting %}{% set _ = ws_list.append('Cutting') %}{% endif %}
            {% if doc.sewing %}{% set _ = ws_list.append('Sewing') %}{% endif %}
            {% if doc.sp %}{% set _ = ws_list.append('Screen Print') %}{% endif %}
            {% if doc.hand_embroidery %}{% set _ = ws_list.append('Hand Embroidery') %}{% endif %}
            {% if doc.karchupi %}{% set _ = ws_list.append('Karchupi') %}{% endif %}
            {% if doc.bp %}{% set _ = ws_list.append('Block Print') %}{% endif %}
            {% if doc.td %}{% set _ = ws_list.append('Tie Dye') %}{% endif %}
            
            {% if ws_list %}
            <div class="section-box">
                <div class="section-header">Workstations:</div>
                <div>{{ ws_list|join(', ') }}</div>
            </div>
            {% endif %}

            <!-- Screen Print Box -->
            {% if doc.sp %}
            <div class="section-box">
                <div class="section-header">Workstation - Screen Print:</div>
                <div class="info-row">Old Frame / SKU# {{ doc.old_frame__sku or '' }}, New Frame / SKU# {{ doc.new_frame__sku or '' }}</div>
                <div class="info-row">Color Units # {{ doc.color_units }}</div>
                
                <!-- Colors -->
                {% set sp_colors = [] %}
                {% if doc.color %}{% set _ = sp_colors.append(doc.color) %}{% endif %}
                {% if doc.color_2 %}{% set _ = sp_colors.append(doc.color_2) %}{% endif %}
                {% if doc.color_3 %}{% set _ = sp_colors.append(doc.color_3) %}{% endif %}
                {% if doc.color_4 %}{% set _ = sp_colors.append(doc.color_4) %}{% endif %}
                
                <div class="info-row" style="margin: 5px 0;">
                    <strong>{{ sp_colors|join(', ') }}</strong>
                </div>

                <!-- Cost Table -->
                <table class="cost-table">
                    <tr><td>Cost for 30 Unit</td><td class="cost-val">{{ doc.cost_for_30_unit or '' }}</td></tr>
                    <tr><td>Cost for 50 Unit</td><td class="cost-val">{{ doc.cost_for_50_unit or '' }}</td></tr>
                    <tr><td>Cost for 70 Unit</td><td class="cost-val">{{ doc.cost_for_70_unit or '' }}</td></tr>
                    <tr><td>Cost for 100 Unit</td><td class="cost-val">{{ doc.cost_for_100_unit or '' }}</td></tr>
                    <tr><td>Cost for 150 Unit</td><td class="cost-val">{{ doc.cost_for_150_unit or '' }} <!-- Assuming field exists, or use generic logic --></td></tr>
                </table>
            </div>
            {% endif %}

            <!-- Hand Embroidery Box -->
            {% if doc.hand_embroidery %}
            <div class="section-box">
                <div class="section-header">Workstation - Hand Embroidery</div>
                <div class="info-row">Color Threads # 3</div> <!-- Static or dynamic? Using static based on image, or add logic if field exists -->
                <div class="info-row" style="margin: 5px 0;">
                    <strong>#29CD42, #CB2929, #ED6396</strong> <!-- Needs dynamic color logic if available -->
                </div>
                <!-- Calculate rate if available -->
                 <table class="cost-table">
                    <tr><td>Cost per Unit</td><td class="cost-val">{{ doc.rate or '' }}</td></tr>
                </table>
                <div class="info-row" style="margin-top: 5px;">
                    Proposed Producer: {{ doc.hand_embroider or '' }}
                    {% if doc.sample %}({{ doc.sample }}){% endif %}
                </div>
            </div>
            {% endif %}

        </div>

        <!-- Right Column (Image) -->
        <div class="right-panel">
            <div class="design-image-container">
                {% if doc.image %}
                    <img src="{{ frappe.utils.get_url(doc.image) }}" class="design-image">
                {% elif doc.additional_images and doc.additional_images[0] %}
                     <img src="{{ frappe.utils.get_url(doc.additional_images[0].image) }}" class="design-image">
                {% else %}
                    <div style="padding: 100px; color: #ccc;">No Main Image Selected</div>
                {% endif %}
            </div>
        </div>

    </div>

    <!-- Footer Note -->
    {% if doc.text_editor_noaa %}
    <div class="footer-box">
        <strong>Note:</strong> {{ doc.text_editor_noaa }}
    </div>
    {% endif %}

    <!-- System Footer -->
    {% if footer %}
    <div style="width: 100%; border-top: 1px solid var(--border-color); margin-top: 10px; padding-top: 5px;">
        {{ footer }}
    </div>
    {% endif %}

</div>
