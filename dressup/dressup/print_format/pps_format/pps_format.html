<style>
    @media print {
        @page {
            size: A4 portrait;
            margin: 8mm;
        }

        .page-break {
            page-break-before: always;
        }
    }

    :root {
        --primary: #000000;
        --accent: #2c3e50;
        --border: #000000;
        --bg-light: #f9f9f9;
        --text-muted: #666;
    }

    .pps-print-container {
        font-family: 'Inter', -apple-system, sans-serif;
        font-size: 8pt;
        color: var(--primary);
        line-height: 1.3;
    }

    .pps-header {
        border-bottom: 2px solid #000;
        padding-bottom: 3px;
        margin-bottom: 5px;
    }

    .info-box-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 15px;
        table-layout: fixed;
    }

    .info-box-table td {
        padding: 8px 10px;
        border: 1px solid #ddd;
        vertical-align: top;
        word-wrap: break-word;
    }

    .cell-label {
        font-size: 7pt;
        font-weight: 700;
        text-transform: uppercase;
        color: var(--text-muted);
        display: block;
        margin-bottom: 2px;
    }

    .cell-value {
        font-size: 7.5pt;
        font-weight: 600;
        display: block;
    }

    .section-title {
        background: #fff;
        color: #000;
        border: 1px solid #000;
        padding: 3px 10px;
        font-size: 8.5pt;
        font-weight: 700;
        text-transform: uppercase;
        margin-top: 5px;
        margin-bottom: 4px;
        border-radius: 2px;
    }

    .swatch-grid-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 5px;
        margin-left: -5px;
        table-layout: fixed;
    }

    .swatch-card {
        border: 1px solid #000;
        border-radius: 4px;
        background: #fff;
        page-break-inside: avoid;
    }

    .swatch-info {
        padding: 8px;
        background: #fff;
        border-bottom: 1px solid #ddd;
    }

    .swatch-code {
        font-weight: 800;
        font-size: 8pt;
    }

    .swatch-name {
        font-size: 7pt;
        color: #444;
    }

    .swatch-qty {
        font-weight: 700;
        color: #000;
        margin-top: 2px;
        font-size: 7.5pt;
        border-top: 1px solid #ccc;
        padding-top: 2px;
    }

    .image-well {
        height: 120px;
        background: #fff;
        padding: 5px;
        text-align: center;
        vertical-align: middle;
    }

    .image-well img {
        max-width: 100%;
        max-height: 150px;
    }

    .manual-placeholder {
        border: 1.5px dashed #ccc;
        height: 140px;
        width: 100%;
        display: block;
        padding-top: 50px;
        color: #999;
        font-size: 6.5pt;
        text-align: center;
        box-sizing: border-box;
    }

    .standard-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 8px;
        border: 1.5px solid #000;
        table-layout: fixed;
    }

    .standard-table th {
        background: #fff;
        border: 1px solid #000;
        padding: 4px;
        font-size: 7.5pt;
        text-align: left;
    }

    .standard-table td {
        border: 1px solid #000;
        padding: 4px;
        font-size: 7.5pt;
        vertical-align: top;
    }

    .gallery-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 12px 0;
        margin-left: -6px;
        table-layout: fixed;
    }

    .gallery-img {
        border: 1px solid #eee;
        padding: 5px;
        background: #fff;
        text-align: center;
        vertical-align: top;
    }

    .gallery-img img {
        width: 100%;
        height: auto;
        border: 1px solid #ddd;
        display: block;
    }

    .gallery-label {
        font-size: 6.5pt;
        font-weight: 700;
        margin-top: 5px;
        background: #fff;
        color: #000;
        border: 0.5pt solid #000;
        padding: 2px;
    }
</style>

<div class="pps-print-container">
    {% if letter_head %}
    <div class="letter-head-container" style="width: 100%; text-align: left; margin-bottom: 10px;">
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td style="text-align: left; padding: 0; border: none;">
                    {{ letter_head }}
                </td>
            </tr>
        </table>
    </div>
    {% endif %}

    <div class="pps-header">
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td>
                    <h1 style="margin: 0; font-size: 11pt; font-weight: 900;">PPS FORMAT <span
                            style="font-weight: 300; font-size: 10pt; color: #666;">/ পিপিএস ফরম্যাট</span></h1>
                    <div style="font-size: 8pt; color: #555;">PRE-PRODUCTION SAMPLE & COMPONENT VERIFICATION SHEET</div>
                </td>
                <td style="text-align: right; font-size: 8pt; font-weight: 700; vertical-align: bottom;">
                    REF: {{ doc.name }}<br>
                    DATE: {{ doc.received_date or frappe.utils.now_datetime().strftime("%d %b %Y") }}
                </td>
            </tr>
        </table>
    </div>

    <div style="border: 1.5px solid #000; padding: 6px; margin-bottom: 8px; border-radius: 4px;">
        <table style="width: 100%; border-collapse: collapse; font-size: 7.5pt; table-layout: fixed;">
            <tr>
                <!-- Left Column -->
                <td style="width: 50%; vertical-align: top; padding-right: 8px;">
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Tech Pack No:</span> {{ doc.tech_pack_no or '-' }}
                    </div>
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Designer Name:</span> {{ doc.handler_name or doc.handler or '-'
                        }}
                    </div>
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Pattern Master:</span> {{ doc.pattern_master_name or
                        doc.pattern_master or '-' }}
                    </div>
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Sample Man:</span> {{ doc.sample_man_name or doc.sample_man or
                        '-' }}
                    </div>
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Style No:</span> {{ doc.link_nsnp or '-' }}
                    </div>
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Category:</span> {{ doc.category or '-' }}
                    </div>
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Season:</span> {{ doc.seson or '-' }}
                    </div>
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Sewing Finish:</span> {{ doc.sewing_finish or '-' }}
                    </div>
                </td>
                <!-- Right Column -->
                <td style="width: 50%; vertical-align: top; padding-left: 8px;">
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Received Date:</span> {{
                        frappe.utils.format_date(doc.received_date) if doc.received_date else '-' }}
                    </div>
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Start Date:</span> {{
                        frappe.utils.format_date(doc.start_time_date) if doc.start_time_date else '-' }}
                    </div>
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Item Name:</span> {{ doc.item_name or doc.item_code or '-' }}
                    </div>
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Cut/ Fit Style:</span> {{ doc.cut_fit_style or '-' }}
                    </div>
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Collar/ Neck Style:</span> {{ doc.collar_neck_style or '-' }}
                    </div>
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Side Cut:</span> {{ doc.side_cut or '-' }}
                    </div>
                    <div style="margin-bottom: 2px; line-height: 1.2;">
                        <span style="font-weight: 700;">Submission Date:</span> {{
                        frappe.utils.format_date(doc.finish_time_date) if doc.finish_time_date else '-' }}
                    </div>
                    <div style="margin-top: 4px; line-height: 1.4;">
                        <span style="font-weight: 700;">Status:</span>
                        {% if doc.docstatus == 0 %}
                        <span
                            style="background: #f39c12; color: #fff; padding: 2px 6px; border-radius: 3px; font-weight: 700; font-size: 7pt;">DRAFT</span>
                        {% elif doc.docstatus == 1 %}
                        <span
                            style="background: #27ae60; color: #fff; padding: 2px 6px; border-radius: 3px; font-weight: 700; font-size: 7pt;">APPROVED</span>
                        {% elif doc.docstatus == 2 %}
                        <span
                            style="background: #c0392b; color: #fff; padding: 2px 6px; border-radius: 3px; font-weight: 700; font-size: 7pt;">CANCELLED</span>
                        {% endif %}
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <!-- NEW ITEM DETAILS SECTION -->
    <div style="display: flex; gap: 8px; margin-bottom: 8px;">
        <div style="flex: 1; border: 1px solid #000; padding: 6px; border-radius: 4px;">
            <div
                style="font-weight: 700; text-transform: uppercase; border-bottom: 1px solid #000; margin-bottom: 4px; font-size: 8pt;">
                Top Details</div>
            <div style="font-size: 7pt;">
                <span style="font-weight: 700;">Color:</span> {{ doc.color or '-' }}<br>
                <span style="font-weight: 700;">Sleeve:</span> {{ doc.sleeve or '-' }}<br>
                <span style="font-weight: 700;">Length:</span> {{ doc.length or '-' }}<br>
                <span style="font-weight: 700;">Lining:</span> {{ doc.lining or '-' }}<br>
                <span style="font-weight: 700;">Value Addition:</span>
                {% for row in doc.value_addition %}{{ row.value_addition }}{% if not loop.last %}, {% endif %}{% else
                %}-{% endfor %}
            </div>
        </div>
        <div style="flex: 1; border: 1px solid #000; padding: 6px; border-radius: 4px;">
            <div
                style="font-weight: 700; text-transform: uppercase; border-bottom: 1px solid #000; margin-bottom: 4px; font-size: 8pt;">
                Bottom Details</div>
            <div style="font-size: 7pt;">
                <span style="font-weight: 700;">Style:</span> {{ doc.bottom_style or '-' }}<br>
                <span style="font-weight: 700;">Color:</span> {{ doc.bottom_color or '-' }}<br>
                <span style="font-weight: 700;">Length:</span> {{ doc.bottom_length or '-' }}<br>
                <span style="font-weight: 700;">Waist:</span> {{ doc.bottom_waist or '-' }}<br>
                <span style="font-weight: 700;">Value Addition:</span>
                {% for row in doc.bottom_value_addition %}{{ row.value_addition }}{% if not loop.last %}, {% endif %}{%
                else %}-{% endfor %}
            </div>
        </div>
        <div style="flex: 1; border: 1px solid #000; padding: 6px; border-radius: 4px;">
            <div
                style="font-weight: 700; text-transform: uppercase; border-bottom: 1px solid #000; margin-bottom: 4px; font-size: 8pt;">
                Dupatta Details</div>
            <div style="font-size: 7pt;">
                <span style="font-weight: 700;">Fabric:</span> {{ doc.dupatta_fabric or '-' }}<br>
                <span style="font-weight: 700;">Color:</span> {{ doc.dupatta_color or '-' }}<br>
                <span style="font-weight: 700;">Value Addition:</span>
                {% for row in doc.dupatta_value_addition %}{{ row.value_addition }}{% if not loop.last %}, {% endif %}{%
                else %}-{% endfor %}
            </div>
        </div>
    </div>

    {% set all_items = (doc.fabrics or []) + (doc.trim_accessories or []) + (doc.fabric_dupatta or []) %}
    {% if all_items %}
    <div class="section-title">Component Swatches / উপকরণের সোয়াচ</div>
    <table class="swatch-grid-table">
        {% for i in range(0, all_items|length, 3) %}
        <tr>
            {% for j in range(0, 3) %}
            {% if i + j < all_items|length %} {% set item=all_items[i + j] %} {% set
                item_image=frappe.db.get_value("Item", item.item_code, "image" ) %} <td style="width: 33.3%;">
                <div class="swatch-card">
                    <div class="swatch-info">
                        <div class="swatch-code">{{ item.item_code }}</div>
                        <div class="swatch-name">{{ item.item_name }}</div>
                        <div class="swatch-qty">
                            <span>Req: {{ "%.2f"|format(item.quantity|float) }} {{ item.default_unit_of_measurement or
                                item.uom or '' }}</span>
                            {% if item.actual_quantity %}
                            <br><span style="color: #444;">Act: {{ "%.2f"|format(item.actual_quantity|float) }} {{
                                item.default_unit_of_measurement or item.uom or '' }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="image-well">
                        {% if item_image %}
                        <img src="{{ item_image }}">
                        {% else %}
                        <div class="manual-placeholder">
                            AFFIX SWATCH HERE<br><span style="font-size: 6pt;">এখানে স্যাম্পল লাগান</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
                </td>
                {% else %}<td style="border: none;">&nbsp;</td>{% endif %}
                {% endfor %}
        </tr>
        {% endfor %}
    </table>
    {% endif %}

    {% if doc.size_chart_in_inch %}
    <div class="section-title">Actual Size Chart / সাইজ চার্ট</div>
    <table class="standard-table">
        <thead>
            <tr>
                <th style="width: 16%;">Size</th>
                <th style="text-align: center;">Length</th>
                <th style="text-align: center;">Bust</th>
                <th style="text-align: center;">Waist</th>
                <th style="text-align: center;">Btm Length</th>
                <th style="text-align: center;">Btm Waist</th>
                <th style="text-align: center;">Leg Open</th>
            </tr>
        </thead>
        <tbody>
            {% for row in doc.size_chart_in_inch %}
            <tr>
                <td style="font-weight: 700;">{{ row.size_chart_in_inch or '-' }}</td>
                <td style="text-align: center;">{{ row.length or '-' }}</td>
                <td style="text-align: center;">{{ row.bust or '-' }}</td>
                <td style="text-align: center;">{{ row.waist or '-' }}</td>
                <td style="text-align: center;">{{ row.bottom_length or '-' }}</td>
                <td style="text-align: center;">{{ row.bottom_waist or '-' }}</td>
                <td style="text-align: center;">{{ row.leg_opening or '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    <table
        style="width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; page-break-inside: avoid;">
        <tr>
            <td style="width: 50%; vertical-align: top; padding-right: 6px;">
                <div class="section-title" style="margin-top: 0;">Washing Guidelines</div>
                <div style="border: 1.5px solid #000; padding: 8px; background: #fff; min-height: 40px;">
                    <div style="font-size: 7.5pt; column-count: 2; column-gap: 10px;">
                        {% if doc.wash_separately %}<div style="margin-bottom: 2px;">• Wash Separately</div>{% endif %}
                        {% if doc.dry_clean_only %}<div style="margin-bottom: 2px;">• Dry Clean Only</div>{% endif %}
                        {% if doc.wash_warm_iron_inside_out %}<div style="margin-bottom: 2px;">• Iron Inside Out</div>{%
                        endif %}
                        {% if doc.hand_wash_only %}<div style="margin-bottom: 2px;">• Hand Wash Only</div>{% endif %}
                    </div>
                    {% if doc.note_or_instructions %}
                    <div style="margin-top: 5px; border-top: 1pt dotted #ccc; padding-top: 4px; font-size: 8pt;">
                        <strong>Note:</strong> {{ doc.note_or_instructions|safe }}
                    </div>
                    {% endif %}
                </div>
            </td>
            {% if doc.pattern_master_note %}
            <td style="width: 50%; vertical-align: top; padding-left: 6px;">
                <div class="section-title" style="margin-top: 0;">Pattern Master Notes</div>
                <div
                    style="border: 1.5px solid #000; padding: 8px; font-size: 7.5pt; min-height: 40px; background: #fff;">
                    {{ doc.pattern_master_note|safe }}
                </div>
            </td>
            {% endif %}
        </tr>
    </table>

    {% if doc.pps_front or doc.pps_back or doc.pps_side %}
    <div class="section-title">PPS Gallery / পিপিএস গ্যালারি</div>
    <table class="gallery-table">
        <tr>
            {% if doc.pps_front %}
            <td class="gallery-img">
                <img src="{{ doc.pps_front }}">
                <div class="gallery-label">FRONT VIEW</div>
            </td>
            {% endif %}
            {% if doc.pps_back %}
            <td class="gallery-img">
                <img src="{{ doc.pps_back }}">
                <div class="gallery-label">BACK VIEW</div>
            </td>
            {% endif %}
            {% if doc.pps_side %}
            <td class="gallery-img">
                <img src="{{ doc.pps_side }}">
                <div class="gallery-label">SIDE VIEW</div>
            </td>
            {% endif %}
        </tr>
    </table>
    {% endif %}

    {% if doc.read_confirm_carefully or doc.docstatus == 1 %}
    <div style="margin-top: 15px; padding: 8px; border: 2pt solid #000; background: #fff; page-break-inside: avoid;">
        <div style="font-size: 7.5pt; font-weight: 900; text-transform: uppercase; color: #000;">Designer's Disclaimer:
        </div>
        <div style="font-size: 7.5pt; line-height: 1.2;">
            {{ doc.read_confirm_carefully or 'Please verify all components, sizing, and colors before moving to bulk
            production. Any deviation must be approved by the design head.' }}
        </div>
    </div>
    {% endif %}

    <table class="footer-table" style="width: 100%; margin-top: 10px; border: none; font-size: 7.5pt; color: #555;">
        <tr>
            <td style="border: none;">DRESSUP MANUFACTURING | PPS MODULE</td>
            <td style="border: none; text-align: right;">PRINTED: {{ frappe.utils.now_datetime().strftime("%d-%m-%Y
                %H:%M") }}</td>
        </tr>
    </table>

    {% if footer %}
    <div id="footer-html" class="visible-pdf">
        <table style="width: 100%; border-top: 1px solid #000; margin-top: 5px;">
            <tr>
                <td style="padding: 5px 0; border: none; font-size: 7.5pt; text-align: center;">
                    {{ footer }}
                </td>
            </tr>
        </table>
    </div>
    {% endif %}
</div>