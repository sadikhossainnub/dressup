<style>
    @media print {
        @page { size: A4 portrait; margin: 8mm; }
        .page-break { page-break-before: always; }
    }
    
    :root {
        --primary: #000000;
        --accent: #2c3e50;
        --border: #000000;
        --bg-light: #f9f9f9;
        --text-muted: #666;
    }

    .pps-print-container {
        font-family: 'Inter', -apple-system, sans-serif;
        font-size: 8.5pt;
        color: var(--primary);
        line-height: 1.3;
    }

    .pps-header {
        border-bottom: 2px solid #000;
        padding-bottom: 10px;
        margin-bottom: 15px;
    }

    .info-box-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 15px;
        table-layout: fixed;
    }

    .info-box-table td {
        padding: 8px 10px;
        border: 1px solid #ddd;
        vertical-align: top;
        word-wrap: break-word;
    }

    .cell-label {
        font-size: 7.5pt;
        font-weight: 700;
        text-transform: uppercase;
        color: var(--text-muted);
        display: block;
        margin-bottom: 2px;
    }

    .cell-value {
        font-size: 9pt;
        font-weight: 600;
        display: block;
    }

    .section-title {
        background: #000;
        color: #fff;
        padding: 6px 12px;
        font-size: 9pt;
        font-weight: 700;
        text-transform: uppercase;
        margin-top: 15px;
        margin-bottom: 10px;
        border-radius: 2px;
    }

    .swatch-grid-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 10px;
        margin-left: -5px;
        table-layout: fixed;
    }

    .swatch-card {
        border: 1px solid #000;
        border-radius: 4px;
        background: #fff;
        page-break-inside: avoid;
    }

    .swatch-info {
        padding: 8px;
        background: #f1f1f1;
        border-bottom: 1px solid #ddd;
    }

    .swatch-code { font-weight: 800; font-size: 9pt; }
    .swatch-name { font-size: 7.5pt; color: #444; }
    .swatch-qty { font-weight: 700; color: #000; margin-top: 2px; font-size: 8pt; border-top: 1px solid #ccc; padding-top: 2px; }

    .image-well {
        height: 160px;
        background: #fff;
        padding: 5px;
        text-align: center;
        vertical-align: middle;
    }

    .image-well img { 
        max-width: 100%; 
        max-height: 150px; 
    }

    .manual-placeholder {
        border: 1.5px dashed #ccc;
        height: 140px;
        width: 100%;
        display: block;
        padding-top: 50px;
        color: #999;
        font-size: 7pt;
        text-align: center;
        box-sizing: border-box;
    }

    .standard-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; border: 1.5px solid #000; table-layout: fixed; }
    .standard-table th { background: #f5f5f5; border: 1px solid #000; padding: 6px; font-size: 8pt; text-align: left; }
    .standard-table td { border: 1px solid #000; padding: 6px; font-size: 8pt; vertical-align: top; }

    .gallery-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 12px 0;
        margin-left: -6px;
        table-layout: fixed;
    }

    .gallery-img {
        border: 1px solid #eee;
        padding: 5px;
        background: #fff;
        text-align: center;
        vertical-align: top;
    }

    .gallery-img img { width: 100%; height: auto; border: 1px solid #ddd; display: block; }
    .gallery-label { font-size: 7pt; font-weight: 700; margin-top: 5px; background: #000; color: #fff; padding: 2px; }

</style>

<div class="pps-print-container">
    {% if letter_head %}
    <div class="letter-head-container" style="width: 100%; text-align: center; margin-bottom: 10px;">
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td style="text-align: center; padding: 0; border: none;">
                    {{ letter_head }}
                </td>
            </tr>
        </table>
    </div>
    {% endif %}

    <div class="pps-header">
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td>
                    <h1 style="margin: 0; font-size: 15pt; font-weight: 900;">PPS FORMAT <span style="font-weight: 300; font-size: 10pt; color: #666;">/ পিপিএস ফরম্যাট</span></h1>
                    <div style="font-size: 8pt; color: #555;">PRE-PRODUCTION SAMPLE & COMPONENT VERIFICATION SHEET</div>
                </td>
                <td style="text-align: right; font-size: 9pt; font-weight: 700; vertical-align: bottom;">
                    REF: {{ doc.name }}<br>
                    DATE: {{ doc.received_date or frappe.utils.now_datetime().strftime("%d %b %Y") }}
                </td>
            </tr>
        </table>
    </div>

    <table class="info-box-table">
        <tr>
            <td>
                <span class="cell-label">Tech Pack No / টেক প্যাক নং</span>
                <span class="cell-value">{{ doc.tech_pack_no }}</span>
            </td>
            <td>
                <span class="cell-label">Category / ক্যাটাগরি</span>
                <span class="cell-value">{{ doc.category or '-' }}</span>
            </td>
            <td>
                <span class="cell-label">Season / সিজন</span>
                <span class="cell-value">{{ doc.seson or '-' }}</span>
            </td>
            <td>
                <span class="cell-label">Sewing Finish / সেলাই ফিনিশ</span>
                <span class="cell-value">{{ doc.sewing_finish or '-' }}</span>
            </td>
        </tr>
        <tr>
            <td>
                <span class="cell-label">Cut/Fit Style / কাট ফিট</span>
                <span class="cell-value">{{ doc.cut_fit_style or '-' }}</span>
            </td>
            <td>
                <span class="cell-label">Collar/Neck / কলার-গলা</span>
                <span class="cell-value">{{ doc.collar_neck_style or '-' }}</span>
            </td>
            <td>
                <span class="cell-label">Side Cut / সাইড কাট</span>
                <span class="cell-value">{{ doc.side_cut or '-' }}</span>
            </td>
            <td>
                <span class="cell-label">Pattern Master / প্যাটার্ন মাস্টার</span>
                <span class="cell-value">{{ doc.pattern_master or '-' }}</span>
            </td>
        </tr>
        <tr>
            <td>
                <span class="cell-label">Item Name / আইটেম</span>
                <span class="cell-value">{{ doc.item_name or (doc.item_code if doc.item_code else '-') }}</span>
            </td>
            <td>
                <span class="cell-label">Sample Man / স্যাম্পল ম্যান</span>
                <span class="cell-value">{{ doc.sample_man or '-' }}</span>
            </td>
            <td>
                <span class="cell-label">Handler / হ্যান্ডলার</span>
                <span class="cell-value">{{ doc.handler or '-' }}</span>
            </td>
            <td>
                <span class="cell-label">Quality Inspection Template</span>
                <span class="cell-value">{{ doc.link_nsnp or '-' }}</span>
            </td>
        </tr>
        <tr>
            <td>
                <span class="cell-label">Start Time / শুরুর সময়</span>
                <span class="cell-value">{{ frappe.utils.format_datetime(doc.start_time_date) if doc.start_time_date else '-' }}</span>
            </td>
            <td>
                <span class="cell-label">Finish Time / শেষ সময়</span>
                <span class="cell-value">{{ frappe.utils.format_datetime(doc.finish_time_date) if doc.finish_time_date else '-' }}</span>
            </td>
            <td>
                 <span class="cell-label">PPS Image Link</span>
                <span class="cell-value" style="word-break: break-all;">{{ doc.pps_image_link_if_any or '-' }}</span>
            </td>
            <td style="background: #fafafa;">
                <span class="cell-label">Status / বর্তমান অবস্থা</span>
                <span class="cell-value" style="color: {{ 'green' if doc.docstatus == 1 else '#f39c12' }}; text-transform: uppercase;">
                    {{ 'SUBMITTED / এপ্রুভড' if doc.docstatus == 1 else 'DRAFT / খসড়া' }}
                </span>
            </td>
        </tr>
    </table>

    {% set all_items = (doc.fabrics or []) + (doc.trim_accessories or []) + (doc.fabric_dupatta or []) %}
    {% if all_items %}
    <div class="section-title">Component Swatches / উপকরণের সোয়াচ</div>
    <table class="swatch-grid-table">
        {% for i in range(0, all_items|length, 3) %}
        <tr>
            {% for j in range(0, 3) %}
            {% if i + j < all_items|length %}
                {% set item = all_items[i + j] %}
                {% set item_image = frappe.db.get_value("Item", item.item_code, "image") %}
                <td style="width: 33.3%;">
                    <div class="swatch-card">
                        <div class="swatch-info">
                            <div class="swatch-code">{{ item.item_code }}</div>
                            <div class="swatch-name">{{ item.item_name }}</div>
                            <div class="swatch-qty">
                                <span>Req: {{ "%.2f"|format(item.quantity|float) }} {{ item.default_unit_of_measurement or item.uom }}</span>
                                {% if item.actual_quantity %}
                                <br><span style="color: #444;">Act: {{ "%.2f"|format(item.actual_quantity|float) }} {{ item.default_unit_of_measurement or item.uom }}</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="image-well">
                            {% if item_image %}
                                <img src="{{ item_image }}">
                            {% else %}
                                <div class="manual-placeholder">
                                    AFFIX SWATCH HERE<br><span style="font-size: 6.5pt;">এখানে স্যাম্পল লাগান</span>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </td>
            {% else %}<td style="border: none;">&nbsp;</td>{% endif %}
            {% endfor %}
        </tr>
        {% endfor %}
    </table>
    {% endif %}

    {% if doc.size_chart_in_inch %}
    <div class="section-title">Actual Size Chart / সাইজ চার্ট</div>
    <table class="standard-table">
        <thead>
            <tr>
                <th style="width: 16%;">Size</th>
                <th style="text-align: center;">Length</th>
                <th style="text-align: center;">Bust</th>
                <th style="text-align: center;">Waist</th>
                <th style="text-align: center;">Btm Length</th>
                <th style="text-align: center;">Btm Waist</th>
                <th style="text-align: center;">Leg Open</th>
            </tr>
        </thead>
        <tbody>
            {% for row in doc.size_chart_in_inch %}
            <tr>
                <td style="font-weight: 700; background: #fafafa;">{{ row.size_chart_in_inch or '-' }}</td>
                <td style="text-align: center;">{{ row.length or '-' }}</td>
                <td style="text-align: center;">{{ row.bust or '-' }}</td>
                <td style="text-align: center;">{{ row.waist or '-' }}</td>
                <td style="text-align: center;">{{ row.bottom_length or '-' }}</td>
                <td style="text-align: center;">{{ row.bottom_waist or '-' }}</td>
                <td style="text-align: center;">{{ row.leg_opening or '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    <table style="width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed;">
        <tr>
            <td style="width: 50%; vertical-align: top; padding-right: 6px;">
                <div class="section-title" style="margin-top: 0;">Washing Guidelines</div>
                <div style="border: 1.5px solid #000; padding: 8px; background: #fff;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 8.5pt;">
                        <tr>
                            <td style="padding: 3px 0;">{{ '☑' if doc.wash_separately else '☐' }} Wash Separately</td>
                            <td style="padding: 3px 0;">{{ '☑' if doc.dry_clean_only else '☐' }} Dry Clean Only</td>
                        </tr>
                        <tr>
                            <td style="padding: 3px 0;">{{ '☑' if doc.wash_warm_iron_inside_out else '☐' }} Iron Inside Out</td>
                            <td style="padding: 3px 0;">{{ '☑' if doc.hand_wash_only else '☐' }} Hand Wash Only</td>
                        </tr>
                    </table>
                    {% if doc.note_or_instructions %}
                    <div style="margin-top: 8px; border-top: 1pt dotted #000; padding-top: 4px; font-size: 8pt;">
                        <strong>Note:</strong> {{ doc.note_or_instructions|safe }}
                    </div>
                    {% endif %}
                </div>
            </td>
            {% if doc.pattern_master_note %}
            <td style="width: 50%; vertical-align: top; padding-left: 6px;">
                <div class="section-title" style="margin-top: 0;">Pattern Master Notes</div>
                <div style="border: 1.5px solid #000; padding: 8px; font-size: 8.5pt; height: 95px; background: #fff;">
                    {{ doc.pattern_master_note|safe }}
                </div>
            </td>
            {% endif %}
        </tr>
    </table>

    {% if doc.pps_front or doc.pps_back or doc.pps_side %}
    <div class="section-title">PPS Gallery / পিপিএস গ্যালারি</div>
    <table class="gallery-table">
        <tr>
            {% if doc.pps_front %}
            <td class="gallery-img">
                <img src="{{ doc.pps_front }}">
                <div class="gallery-label">FRONT VIEW</div>
            </td>
            {% endif %}
            {% if doc.pps_back %}
            <td class="gallery-img">
                <img src="{{ doc.pps_back }}">
                <div class="gallery-label">BACK VIEW</div>
            </td>
            {% endif %}
            {% if doc.pps_side %}
            <td class="gallery-img">
                <img src="{{ doc.pps_side }}">
                <div class="gallery-label">SIDE VIEW</div>
            </td>
            {% endif %}
        </tr>
    </table>
    {% endif %}

    <div style="margin-top: 15px; padding: 8px; border: 2pt solid #000; background: #eee;">
        <div style="font-size: 7.5pt; font-weight: 900; text-transform: uppercase; color: #000;">Designer's Disclaimer:</div>
        <div style="font-size: 7.5pt; line-height: 1.2;">
            {{ doc.read_confirm_carefully or 'Please verify all components, sizing, and colors before moving to bulk production. Any deviation must be approved by the design head.' }}
        </div>
    </div>

    <table style="width: 100%; margin-top: 10px; border: none; font-size: 7.5pt; color: #555;">
        <tr>
            <td style="border: none;">DRESSUP MANUFACTURING | PPS MODULE</td>
            <td style="border: none; text-align: right;">PRINTED: {{ frappe.utils.now_datetime().strftime("%d-%m-%Y %H:%M") }}</td>
        </tr>
    </table>

    {% if footer %}
    <div id="footer-html" class="visible-pdf">
        <table style="width: 100%; border-top: 1px solid #000; margin-top: 5px;">
            <tr>
                <td style="padding: 5px 0; border: none; font-size: 8pt; text-align: center;">
                    {{ footer }}
                </td>
            </tr>
        </table>
    </div>
    {% endif %}
</div>
