<style>
    @media print {
        @page {
            size: A4 portrait;
            margin: 10mm;
        }
        .no-print { display: none; }
    }
    
    :root {
        --primary: #000000;
        --primary-light: #333333;
        --secondary: #666666;
        --accent: #000000;
        --bg-light: #f2f2f2;
        --text-main: #000000;
        --text-muted: #444444;
        --border-color: #000000;
    }

    .print-format-container {
        font-family: 'Poppins', sans-serif;
        font-size: 10pt;
        line-height: 1.4;
        color: var(--text-main);
        background: #fff;
        width: 100%;
        margin: 0;
        padding: 0;
    }
    
    .print-content {
        padding: 5mm 0;
    }
    
    .header-custom {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        border-bottom: 2.5pt solid var(--primary);
        padding-bottom: 10px;
        margin-bottom: 15px;
    }
    
    .header-left h1 {
        margin: 0;
        color: var(--primary);
        font-size: 22pt;
        font-weight: 700;
        letter-spacing: -0.5px;
    }
    
    .doc-info {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        margin-bottom: 20px;
        padding: 12px;
        border: 1pt solid var(--border-color);
        border-radius: 4px;
    }
    
    .info-group {
        display: flex;
        flex-direction: column;
    }
    
    .info-label {
        font-size: 8pt;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
    }
    
    .info-value {
        font-size: 10pt;
        font-weight: 600;
        color: var(--text-main);
    }
    
    .section {
        margin-bottom: 15px;
    }
    
    .section-title {
        font-size: 11pt;
        font-weight: 700;
        color: var(--text-main);
        text-transform: uppercase;
        border-bottom: 1.5pt solid var(--primary);
        display: inline-block;
        margin-bottom: 8px;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 9pt;
    }
    
    table thead th {
        background: #000;
        color: #fff;
        padding: 8px;
        text-align: left;
        font-weight: 600;
    }
    
    table tbody td {
        padding: 6px 8px;
        border-bottom: 0.5pt solid #ddd;
    }
    
    .text-right { text-align: right; }
    
    .total-row {
        background: #f8f9fa;
        font-weight: 700;
        border-top: 1pt solid #000;
    }
    
    .grid-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }
    
    .card {
        padding: 10px;
        background: white;
        border: 1pt solid var(--border-color);
        border-radius: 4px;
    }
    
    .card-label {
        font-size: 8pt;
        font-weight: 600;
        color: var(--text-muted);
        margin-bottom: 2px;
    }
    
    .card-value {
        font-size: 10pt;
        font-weight: 600;
        color: var(--text-main);
    }
    
    .summary-box {
        background: #fff;
        color: #000;
        border: 2pt solid #000;
        padding: 15px;
        border-radius: 4px;
        margin-top: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .summary-main {
        text-align: right;
    }
    
    .summary-main .label {
        font-size: 10pt;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .summary-main .value {
        font-size: 24pt;
        font-weight: 700;
        line-height: 1;
    }
    
    .summary-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        flex-grow: 1;
        margin-right: 30px;
    }
    
    .summary-item {
        border-left: 3pt solid #000;
        padding-left: 10px;
    }
    
    .selling-prices {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin-top: 15px;
    }
    
    .price-chip {
        background: white;
        border: 1px solid var(--primary-light);
        border-radius: 8px;
        padding: 10px;
        text-align: center;
    }
    
    .price-chip label {
        display: block;
        font-size: 8pt;
        color: var(--text-muted);
        margin-bottom: 4px;
    }
    
    .price-chip .value {
        font-size: 14pt;
        font-weight: 700;
        color: var(--primary);
    }
    
    .price-chip .margin {
        font-size: 7pt;
        background: var(--secondary);
        color: white;
        padding: 2px 6px;
        border-radius: 10px;
        display: inline-block;
        margin-top: 4px;
    }
    
    .footer-custom {
        margin-top: 20px;
        padding-top: 10px;
        border-top: 1px dashed var(--border-color);
        display: flex;
        justify-content: space-between;
        font-size: 8pt;
        color: var(--text-muted);
    }
    
    .notes {
        font-size: 8pt;
        color: #666;
        font-style: italic;
        margin-top: 10px;
        padding: 8px;
        background: #fff9c4;
        border-radius: 4px;
    }
</style>

<div class="print-format-container">
    {% if letter_head %}
    <div class="letter-head-container">
        {{ letter_head }}
    </div>
    {% endif %}

    <div class="print-content">
        <div class="header-custom">
            <div class="header-left">
                <h1>COST ESTIMATION</h1>
            </div>
            <div class="header-right">
                <div class="company-name">{{ frappe.db.get_default("Company") or "DressUp" }}</div>
            </div>
        </div>
        
        <div class="doc-info">
            <div class="info-group">
                <span class="info-label">Doc No</span>
                <span class="info-value">{{ doc.name }}</span>
            </div>
            <div class="info-group">
                <span class="info-label">Tech Pack</span>
                <span class="info-value">{{ doc.tech_pack_no }}</span>
            </div>
            <div class="info-group">
                <span class="info-label">Design No</span>
                <span class="info-value">{{ doc.design_no }}</span>
            </div>
            <div class="info-group">
                <span class="info-label">Date</span>
                <span class="info-value">{{ frappe.utils.formatdate(doc.date, "dd MMM yyyy") }}</span>
            </div>
            <div class="info-group">
                <span class="info-label">Designer</span>
                <span class="info-value">{{ doc.designer }}</span>
            </div>
            <div class="info-group">
                <span class="info-label">Category</span>
                <span class="info-value">{{ doc.category or "-" }}</span>
            </div>
            <div class="info-group">
                <span class="info-label">Item</span>
                <span class="info-value">{{ doc.item_name or "-" }}</span>
            </div>
            <div class="info-group">
                <span class="info-label">Status</span>
                <span class="info-value">{% if doc.docstatus == 1 %}SUBMITTED{% else %}DRAFT{% endif %}</span>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">Raw Materials & Accessories</div>
            <table>
                <thead>
                    <tr>
                        <th style="width: 45%">Item Description</th>
                        <th style="width: 15%" class="text-right">Qty</th>
                        <th style="width: 10%">UOM</th>
                        <th style="width: 15%" class="text-right">Rate</th>
                        <th style="width: 15%" class="text-right">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in doc.materials %}
                    <tr>
                        <td><strong>{{ row.item_code }}</strong><br><small>{{ row.item_name }}</small></td>
                        <td class="text-right">{{ "%.2f"|format(row.qty or 0) }}</td>
                        <td>{{ row.uom }}</td>
                        <td class="text-right">{{ frappe.utils.fmt_money(row.rate, currency=doc.currency) }}</td>
                        <td class="text-right">{{ frappe.utils.fmt_money(row.amount, currency=doc.currency) }}</td>
                    </tr>
                    {% endfor %}
                    {% for row in doc.accessories %}
                    <tr>
                        <td><strong>{{ row.itemcode }}</strong><br><small>{{ row.item_name }}</small></td>
                        <td class="text-right">{{ "%.2f"|format(row.qty or 0) }}</td>
                        <td>Nos</td>
                        <td class="text-right">{{ frappe.utils.fmt_money(row.rate, currency=doc.currency) }}</td>
                        <td class="text-right">{{ frappe.utils.fmt_money(row.amount, currency=doc.currency) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="section">
                <div class="section-title">Tailoring Charges</div>
                <div class="grid-container" style="grid-template-columns: 1fr 1fr;">
                    {% if doc.cutting_f %}<div class="card"><div class="card-label">Cutting</div><div class="card-value">{{ frappe.utils.fmt_money(doc.cutting_f, currency=doc.currency) }}</div></div>{% endif %}
                    {% if doc.sewing_f %}<div class="card"><div class="card-label">Sewing</div><div class="card-value">{{ frappe.utils.fmt_money(doc.sewing_f, currency=doc.currency) }}</div></div>{% endif %}
                    {% if doc.machine_embroidery_f %}<div class="card"><div class="card-label">Machine Emb</div><div class="card-value">{{ frappe.utils.fmt_money(doc.machine_embroidery_f, currency=doc.currency) }}</div></div>{% endif %}
                    {% if doc.hand_embroidery_f %}<div class="card"><div class="card-label">Hand Emb</div><div class="card-value">{{ frappe.utils.fmt_money(doc.hand_embroidery_f, currency=doc.currency) }}</div></div>{% endif %}
                    {% if doc.hand_work_estimation %}<div class="card"><div class="card-label">Hand Work</div><div class="card-value">{{ frappe.utils.fmt_money(doc.hand_work_estimation, currency=doc.currency) }}</div></div>{% endif %}
                    {% if doc.karchupi_f %}<div class="card"><div class="card-label">Karchupi</div><div class="card-value">{{ frappe.utils.fmt_money(doc.karchupi_f, currency=doc.currency) }}</div></div>{% endif %}
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">Finishing Charges</div>
                <div class="grid-container" style="grid-template-columns: 1fr;">
                    <div style="display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #eee;">
                        <span>Wash & Iron</span><span>{{ frappe.utils.fmt_money(doc.wash_iron or 0, currency=doc.currency) }}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #eee;">
                        <span>QC & Packaging</span><span>{{ frappe.utils.fmt_money(doc.qc_packaging or 0, currency=doc.currency) }}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #eee;">
                        <span>Transportation</span><span>{{ frappe.utils.fmt_money(doc.transportation or 0, currency=doc.currency) }}</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="summary-box">
            <div class="summary-details">
                <div class="summary-item">
                    <div style="font-size: 8pt; opacity: 0.8;">Material & Trims</div>
                    <div style="font-size: 11pt; font-weight: 600;">{{ frappe.utils.fmt_money((doc.total_fabric or 0) + (doc.total_trim_and_accessories or 0), currency=doc.currency) }}</div>
                </div>
                <div class="summary-item">
                    <div style="font-size: 8pt; opacity: 0.8;">Labor & Process</div>
                    <div style="font-size: 11pt; font-weight: 600;">{{ frappe.utils.fmt_money((doc.total_tailoring or 0) + (doc.total_finishing or 0), currency=doc.currency) }}</div>
                </div>
            </div>
            <div class="summary-main">
                <div class="label">TOTAL UNIT COST</div>
                <div class="value">{{ frappe.utils.fmt_money((doc.total_fabric or 0) + (doc.total_trim_and_accessories or 0) + (doc.total_tailoring or 0) + (doc.total_finishing or 0), currency=doc.currency) }}</div>
            </div>
        </div>
        
        <div class="section" style="margin-top: 20px;">
            <div class="section-title">Market Strategy (Suggested Selling)</div>
            <div class="selling-prices">
                <div class="price-chip">
                    <label>Standard Variation</label>
                    <div class="value">{{ frappe.utils.fmt_money(doc.for_pattern_variation_only, currency=doc.currency) }}</div>
                    <div class="margin">{{ doc.pattern_variation or 52 }}% GP</div>
                </div>
                <div class="price-chip">
                    <label>Screen Print/Emb</label>
                    <div class="value">{{ frappe.utils.fmt_money(doc.screen_print_machine_emb_only, currency=doc.currency) }}</div>
                    <div class="margin">65% GP</div>
                </div>
                <div class="price-chip">
                    <label>Hand Embroidery</label>
                    <div class="value">{{ frappe.utils.fmt_money(doc.hand_embroidery_only, currency=doc.currency) }}</div>
                    <div class="margin">75% GP</div>
                </div>
            </div>
        </div>
        
        {% if doc.important_note %}
        <div class="notes">
            <strong>Notes:</strong> {{ doc.important_note }}
        </div>
        {% endif %}
        
        <div class="footer-custom">
            <span>System Generated: {{ frappe.utils.now_datetime().strftime("%d-%m-%Y %H:%M") }}</span>
            <span>DressUp Costing Engine v2.0</span>
            <span>Confidential Document</span>
        </div>
    </div>
</div>

