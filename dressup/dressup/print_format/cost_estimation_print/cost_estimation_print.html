<style>
    @media print {
        @page {
            size: A4 portrait;
            margin: 7mm;
        }
        .no-print { display: none; }
    }
    
    :root {
        --primary: #000000;
        --primary-light: #333333;
        --secondary: #666666;
        --accent: #000000;
        --bg-light: #f2f2f2;
        --text-main: #000000;
        --text-muted: #444444;
        --border-color: #000000;
    }

    .print-format-container {
        font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-size: 8pt;
        line-height: 1.1;
        color: var(--text-main);
        background: #fff;
        width: 100%;
        margin: 0;
        padding: 0;
    }
    
    .print-content {
        padding: 1mm 0;
    }
    
    .header-table {
        width: 100%;
        border-collapse: collapse;
        border-bottom: 2pt solid var(--primary);
        margin-bottom: 4px;
    }

    .header-table td {
        vertical-align: bottom;
        padding-bottom: 2px;
        border: none;
    }
    
    .header-left h1 {
        margin: 0;
        color: var(--primary);
        font-size: 14pt;
        font-weight: 700;
        letter-spacing: -0.5px;
    }
    
    .doc-info-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 5px;
        border: 1pt solid var(--border-color);
        table-layout: fixed;
    }

    .doc-info-table td {
        padding: 2px 6px;
        border: 1pt solid #ddd;
        width: 25%;
        vertical-align: top;
    }
    
    .info-label {
        font-size: 7pt;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        display: block;
        line-height: 1;
    }
    
    .info-value {
        font-size: 8.5pt;
        font-weight: 600;
        color: var(--text-main);
        display: block;
        line-height: 1.1;
    }
    
    .section {
        margin-bottom: 4px;
    }
    
    .section-title {
        font-size: 9pt;
        font-weight: 700;
        color: var(--text-main);
        text-transform: uppercase;
        border-bottom: 1.5pt solid var(--primary);
        display: inline-block;
        margin-bottom: 2px;
    }
    
    .standard-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 8.5pt;
    }
    
    .standard-table thead th {
        background: #f2f2f2;
        color: #000000;
        padding: 3px 6px;
        text-align: left;
        font-weight: 700;
        border: 1px solid #000;
    }
    
    .standard-table tbody td {
        padding: 2px 6px;
        border: 1px solid #ddd;
    }
    
    .text-right { text-align: right; }
    
    .total-row {
        background: #f8f9fa;
        font-weight: 700;
        border-top: 1pt solid #000;
    }
    
    .card {
        padding: 4px 8px;
        background: white;
        border: 1pt solid var(--border-color);
        border-radius: 4px;
        margin-bottom: 2px;
    }
    
    .card-label {
        font-size: 7.5pt;
        font-weight: 700;
        color: var(--text-muted);
        margin-bottom: 1px;
        line-height: 1;
    }
    
    .card-value {
        font-size: 9pt;
        font-weight: 600;
        color: var(--text-main);
    }
    
    .summary-table {
        width: 100%;
        border-collapse: collapse;
        border: 2pt solid #000;
        margin-top: 6px;
        background: #fff;
    }

    .summary-table td {
        padding: 3px 8px;
        vertical-align: middle;
        border: none;
    }
    
    .summary-item {
        padding-left: 8px;
        margin-bottom: 2px;
    }
    
    .summary-main {
        text-align: right;
    }
    
    .summary-main .label {
        font-size: 8pt;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .summary-main .value {
        font-size: 12pt;
        font-weight: 700;
        line-height: 1;
    }
    
    .selling-prices-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 10px 0;
        margin-top: 6px;
    }

    .selling-prices-table td {
        width: 33.33%;
        vertical-align: top;
        padding: 0;
        border: none;
    }
    
    .price-chip {
        background: white;
        border: 1px solid var(--primary-light);
        border-radius: 8px;
        padding: 4px 8px;
        text-align: center;
    }
    
    .price-chip label {
        display: block;
        font-size: 8pt;
        color: var(--text-muted);
        margin-bottom: 4px;
    }
    
    .price-chip .value {
        font-size: 14pt;
        font-weight: 700;
        color: var(--primary);
    }
    
    .price-chip .margin {
        font-size: 7pt;
        background: var(--secondary);
        color: white;
        padding: 2px 6px;
        border-radius: 10px;
        display: inline-block;
        margin-top: 4px;
    }
    
    .footer-table {
        width: 100%;
        margin-top: 8px;
        padding-top: 6px;
        border-top: 1px dashed var(--border-color);
        font-size: 8pt;
        color: var(--text-muted);
    }

    .footer-table td {
        border: none;
        padding: 5px 0;
    }
    
    .notes {
        font-size: 8pt;
        color: #666;
        font-style: italic;
        margin-top: 6px;
        padding: 4px 8px;
        background: #fff9c4;
        border-radius: 4px;
    }
</style>

<div class="print-format-container">
    {% if letter_head %}
    <div class="letter-head-container" style="width: 100%; text-align: center; margin-bottom: 5px;">
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td style="text-align: center; padding: 0; border: none;">
                    {{ letter_head }}
                </td>
            </tr>
        </table>
    </div>
    {% endif %}

    <div class="print-content">
        <table class="header-table">
            <tr>
                <td>
                    <div class="header-left">
                        <h1>COST ESTIMATION / আনুমানিক খরচের হিসাব</h1>
                    </div>
                </td>
                <td style="text-align: right;">
                    <div class="company-name" style="font-weight: 700; font-size: 12pt;">{{ doc.name }}</div>
                </td>
            </tr>
        </table>
        
        <table class="doc-info-table">
            <tr>
                <td>
                    <span class="info-label">Doc No / নথি নং</span>
                    <span class="info-value">{{ doc.name }}</span>
                </td>
                {% if doc.tech_pack_no %}
                <td>
                    <span class="info-label">Tech Pack / টেক প্যাক</span>
                    <span class="info-value">{{ doc.tech_pack_no }}</span>
                </td>
                {% endif %}
                {% if doc.design_no %}
                <td>
                    <span class="info-label">Design No / ডিজাইনের নম্বর</span>
                    <span class="info-value">{{ doc.design_no }}</span>
                </td>
                {% endif %}
                <td>
                    <span class="info-label">Date / তারিখ</span>
                    <span class="info-value">{{ frappe.utils.formatdate(doc.date, "dd MMM yyyy") }}</span>
                </td>
            </tr>
            <tr>
                {% if doc.designer %}
                <td>
                    <span class="info-label">Designer / ডিজাইনার</span>
                    <span class="info-value">{{ doc.designer }}</span>
                </td>
                {% endif %}
                {% if doc.category %}
                <td>
                    <span class="info-label">Category / ক্যাটাগরি</span>
                    <span class="info-value">{{ doc.category }}</span>
                </td>
                {% endif %}
                {% if doc.item_name %}
                <td>
                    <span class="info-label">Item / আইটেম</span>
                    <span class="info-value">{{ doc.item_name }}</span>
                </td>
                {% endif %}
                <td>
                    <span class="info-label">Status / অবস্থা</span>
                    <span class="info-value">{% if doc.docstatus == 1 %}SUBMITTED / জমা হয়েছে{% else %}DRAFT / খসড়া{% endif %}</span>
                </td>
            </tr>
        </table>
        
        {% if doc.materials %}
        <div class="section" style="page-break-inside: avoid;">
            <div class="section-title">Fabrics / ফ্যাব্রিকস</div>
            <table class="standard-table" style="table-layout: fixed;">
                <thead>
                    <tr>
                        <th style="width: 45%">Item Description / আইটেমের বর্ণনা</th>
                        <th style="width: 15%" class="text-right">Qty / পঃ</th>
                        <th style="width: 10%">UOM</th>
                        <th style="width: 15%" class="text-right">Rate / দর</th>
                        <th style="width: 15%" class="text-right">Amount / মোট</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in doc.materials %}
                    <tr>
                        <td><strong>{{ row.item_code }}</strong><br><small>{{ row.item_name }}</small></td>
                        <td class="text-right">{{ "%.2f"|format(row.qty or 0) }}</td>
                        <td>{{ row.uom }}</td>
                        <td class="text-right">{{ frappe.utils.fmt_money(row.rate, currency=doc.currency) }}</td>
                        <td class="text-right">{{ frappe.utils.fmt_money(row.amount, currency=doc.currency) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        {% if doc.accessories %}
        <div class="section" style="page-break-inside: avoid;">
            <div class="section-title">Trims & Accessories / ট্রিমস ও এক্সেসরিজ</div>
            <table class="standard-table" style="table-layout: fixed;">
                <thead>
                    <tr>
                        <th style="width: 45%">Item Description / আইটেমের বর্ণনা</th>
                        <th style="width: 15%" class="text-right">Qty / পঃ</th>
                        <th style="width: 10%">UOM</th>
                        <th style="width: 15%" class="text-right">Rate / দর</th>
                        <th style="width: 15%" class="text-right">Amount / মোট</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in doc.accessories %}
                    <tr>
                        <td><strong>{{ row.itemcode }}</strong><br><small>{{ row.item_name }}</small></td>
                        <td class="text-right">{{ "%.2f"|format(row.qty or 0) }}</td>
                        <td>Nos</td>
                        <td class="text-right">{{ frappe.utils.fmt_money(row.rate, currency=doc.currency) }}</td>
                        <td class="text-right">{{ frappe.utils.fmt_money(row.amount, currency=doc.currency) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
        
        {% if doc.cutting_f or doc.sewing_f or doc.machine_embroidery_f or doc.hand_embroidery_f or doc.hand_work_estimation or doc.karchupi_f or doc.screen_print_f or doc.block_print_f or doc.tie_dye or doc.wash_iron or doc.qc_packaging or doc.transportation %}
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 6px; table-layout: fixed; page-break-inside: avoid;">
            <tr>
                {% if doc.cutting_f or doc.sewing_f or doc.machine_embroidery_f or doc.hand_embroidery_f or doc.hand_work_estimation or doc.karchupi_f or doc.screen_print_f or doc.block_print_f or doc.tie_dye %}
                <td style="width: {{ '55%' if (doc.wash_iron or doc.qc_packaging or doc.transportation) else '100%' }}; vertical-align: top; padding-right: 15px; border: none;">
                    <div class="section">
                        <div class="section-title">Tailoring Charges / সেলাই খরচ</div>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="width: 50%; padding-right: 5px; border: none; vertical-align: top;">
                                    {% if doc.cutting_f %}<div class="card"><div class="card-label">Cutting / কাটিং</div><div class="card-value">{{ frappe.utils.fmt_money(doc.cutting_f, currency=doc.currency) }}</div></div>{% endif %}
                                    {% if doc.sewing_f %}<div class="card"><div class="card-label">Sewing / সেলাই</div><div class="card-value">{{ frappe.utils.fmt_money(doc.sewing_f, currency=doc.currency) }}</div></div>{% endif %}
                                    {% if doc.machine_embroidery_f %}<div class="card"><div class="card-label">Machine Emb / মেশিন এমব্রয়ডারি</div><div class="card-value">{{ frappe.utils.fmt_money(doc.machine_embroidery_f, currency=doc.currency) }}</div></div>{% endif %}
                                    {% if doc.screen_print_f %}<div class="card"><div class="card-label">Screen Print / স্ক্রিন প্রিন্ট</div><div class="card-value">{{ frappe.utils.fmt_money(doc.screen_print_f, currency=doc.currency) }}</div></div>{% endif %}
                                </td>
                                <td style="width: 50%; padding-left: 5px; border: none; vertical-align: top;">
                                    {% if doc.hand_embroidery_f %}<div class="card"><div class="card-label">Hand Emb / হাতের এমব্রয়ডারি</div><div class="card-value">{{ frappe.utils.fmt_money(doc.hand_embroidery_f, currency=doc.currency) }}</div></div>{% endif %}
                                    {% if doc.hand_work_estimation %}<div class="card"><div class="card-label">Hand Work / হাতের কাজ</div><div class="card-value">{{ frappe.utils.fmt_money(doc.hand_work_estimation, currency=doc.currency) }}</div></div>{% endif %}
                                    {% if doc.karchupi_f %}<div class="card"><div class="card-label">Karchupi / কারচুপি</div><div class="card-value">{{ frappe.utils.fmt_money(doc.karchupi_f, currency=doc.currency) }}</div></div>{% endif %}
                                    {% if doc.block_print_f %}<div class="card"><div class="card-label">Block Print / ব্লক প্রিন্ট</div><div class="card-value">{{ frappe.utils.fmt_money(doc.block_print_f, currency=doc.currency) }}</div></div>{% endif %}
                                    {% if doc.tie_dye %}<div class="card"><div class="card-label">Tie & Dye / টাই ডাই</div><div class="card-value">{{ frappe.utils.fmt_money(doc.tie_dye, currency=doc.currency) }}</div></div>{% endif %}
                                </td>
                            </tr>
                        </table>
                    </div>
                </td>
                {% endif %}

                {% if doc.wash_iron or doc.qc_packaging or doc.transportation %}
                <td style="width: {{ '45%' if (doc.cutting_f or doc.sewing_f or doc.machine_embroidery_f or doc.hand_embroidery_f or doc.hand_work_estimation or doc.karchupi_f or doc.screen_print_f or doc.block_print_f or doc.tie_dye) else '100%' }}; vertical-align: top; padding-left: 15px; border: none;">
                    <div class="section">
                        <div class="section-title">Finishing Charges / ফিনিশিং খরচ</div>
                        <table style="width: 100%; border-collapse: collapse;">
                            {% if doc.wash_iron %}
                            <tr>
                                <td style="padding: 4px 0; border-bottom: 1px solid #eee;">Wash & Iron / ওয়াশ ও আয়রন</td>
                                <td style="padding: 4px 0; border-bottom: 1px solid #eee; text-align: right;">{{ frappe.utils.fmt_money(doc.wash_iron, currency=doc.currency) }}</td>
                            </tr>
                            {% endif %}
                            {% if doc.qc_packaging %}
                            <tr>
                                <td style="padding: 4px 0; border-bottom: 1px solid #eee;">QC & Packaging / কিউসি ও প্যাকিং</td>
                                <td style="padding: 4px 0; border-bottom: 1px solid #eee; text-align: right;">{{ frappe.utils.fmt_money(doc.qc_packaging, currency=doc.currency) }}</td>
                            </tr>
                            {% endif %}
                            {% if doc.transportation %}
                            <tr>
                                <td style="padding: 4px 0; border-bottom: 1px solid #eee;">Transportation / ট্রান্সপোর্ট</td>
                                <td style="padding: 4px 0; border-bottom: 1px solid #eee; text-align: right;">{{ frappe.utils.fmt_money(doc.transportation, currency=doc.currency) }}</td>
                            </tr>
                            {% endif %}
                        </table>
                    </div>
                </td>
                {% endif %}
            </tr>
        </table>
        {% endif %}
        
        <table class="summary-table">
            <tr>
                <td style="width: 15%;">
                    <div class="summary-item">
                        <div style="font-size: 8pt; opacity: 0.8; text-transform: uppercase;">Fabrics</div>
                        <div style="font-size: 11pt; font-weight: 600;">{{ frappe.utils.fmt_money(doc.total_fabric or 0, currency=doc.currency) }}</div>
                    </div>
                </td>
                <td style="width: 15%;">
                    <div class="summary-item">
                        <div style="font-size: 8pt; opacity: 0.8; text-transform: uppercase;">Trims</div>
                        <div style="font-size: 11pt; font-weight: 600;">{{ frappe.utils.fmt_money(doc.total_trim_and_accessories or 0, currency=doc.currency) }}</div>
                    </div>
                </td>
                <td style="width: 15%;">
                    <div class="summary-item">
                        <div style="font-size: 8pt; opacity: 0.8; text-transform: uppercase;">Tailoring</div>
                        <div style="font-size: 11pt; font-weight: 600;">{{ frappe.utils.fmt_money(doc.total_tailoring or 0, currency=doc.currency) }}</div>
                    </div>
                </td>
                <td style="width: 15%;">
                    <div class="summary-item">
                        <div style="font-size: 8pt; opacity: 0.8; text-transform: uppercase;">Finishing</div>
                        <div style="font-size: 11pt; font-weight: 600;">{{ frappe.utils.fmt_money(doc.total_finishing or 0, currency=doc.currency) }}</div>
                    </div>
                </td>
                <td style="width: 40%; text-align: right;">
                    <div class="summary-main">
                        <div class="label">TOTAL UNIT COST / প্রতি পিসের খরচ</div>
                        <div class="value">{{ frappe.utils.fmt_money((doc.total_fabric or 0) + (doc.total_trim_and_accessories or 0) + (doc.total_tailoring or 0) + (doc.total_finishing or 0), currency=doc.currency) }}</div>
                    </div>
                </td>
            </tr>
        </table>
        
        {% if doc.for_pattern_variation_only or doc.screen_print_machine_emb_only or doc.hand_embroidery_only %}
        <div class="section" style="margin-top: 8px;">
            <div class="section-title">Market Strategy (Suggested Selling)</div>
            <table class="selling-prices-table">
                <tr>
                    {% if doc.for_pattern_variation_only %}
                    <td>
                        <div class="price-chip">
                            <label>Standard Variation</label>
                            <div class="value">{{ frappe.utils.fmt_money(doc.for_pattern_variation_only, currency=doc.currency) }}</div>
                            <div class="margin">{{ doc.pattern_variation or 52 }}% GP</div>
                        </div>
                    </td>
                    {% endif %}
                    {% if doc.screen_print_machine_emb_only %}
                    <td>
                        <div class="price-chip">
                            <label>Screen Print/Emb</label>
                            <div class="value">{{ frappe.utils.fmt_money(doc.screen_print_machine_emb_only, currency=doc.currency) }}</div>
                            <div class="margin">65% GP</div>
                        </div>
                    </td>
                    {% endif %}
                    {% if doc.hand_embroidery_only %}
                    <td>
                        <div class="price-chip">
                            <label>Hand Embroidery</label>
                            <div class="value">{{ frappe.utils.fmt_money(doc.hand_embroidery_only, currency=doc.currency) }}</div>
                            <div class="margin">75% GP</div>
                        </div>
                    </td>
                    {% endif %}
                </tr>
            </table>
        </div>
        {% endif %}
        
        {% if doc.important_note %}
        <div class="notes">
            <strong>Notes:</strong> {{ doc.important_note }}
        </div>
        {% endif %}
        
        <table class="footer-table" style="color: #000; border-top: 1pt solid #000;">
            <tr>
                <td>System Generated: {{ frappe.utils.now_datetime().strftime("%d-%m-%Y %H:%M") }}</td>
                <td style="text-align: center;">DressUp Costing Engine v2.0</td>
                <td style="text-align: right;">Confidential Document</td>
            </tr>
        </table>
    </div>

    {% if footer %}
    <div id="footer-html" class="visible-pdf">
        <table style="width: 100%; border-top: 1px solid #000; margin-top: 5px;">
            <tr>
                <td style="padding: 5px 0; border: none; font-size: 8pt; text-align: center;">
                    {{ footer }}
                </td>
            </tr>
        </table>
    </div>
    {% endif %}
</div>
